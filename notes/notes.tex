\documentclass[11pt]{article}

\input{format.tex}

\title{Notes}
\begin{document}
\maketitle
\section{Diffusion}
\subsection{Laplace equation (follows from Gauss' law)}
The electric potential satisfies the elliptic equation
\begin{equation}
	\bnabla \bcdot (C \bnabla \varPhi) = 0; \label{Phi eqn}
\end{equation}
$C$ is salt concentration, playing the role of $\eps$,
in Maxwell's equation (where $\vect{E} = -\bnabla \varPhi$):
\begin{equation}
\bnabla \bcdot \vect{D} = \bnabla \bcdot \eps \vect{E} = \rho_{free}
\end{equation}

We assume regular grid $\{(x_i, y_j)\}$,
where $i\in\{0 \ldots n\}$ and $j\in\{0 \ldots m\}$. The maximal and the
minimal indices' values correspond to the boundary of the problem.

We approximate the differential operator as:
\begin{eqnarray}
\left[ \bnabla \bcdot (C \bnabla \varPhi) \right]_{i,j}
&\approx &\frac{2}{x_{i+1,j} - x_{i-1,j}} \left(
C_{i+1/2,j} \cdot \frac{\varPhi_{i+1,j}-\varPhi_{i,j}}{x_{i+1}-x_{i}} -
C_{i-1/2,j} \cdot \frac{\varPhi_{i,j}-\varPhi_{i-1,j}}{x_{i}-x_{i-1}}
\right) + \\
&&\frac{2}{y_{i,j+1} - y_{i,j-1}} \left(C_{i,j+1/2} \cdot \frac{\varPhi_{i,j+1}-\varPhi_{i,j}}{y_{i+1}-y_{i}} -
C_{i,j-1/2} \cdot \frac{\varPhi_{i,j}-\varPhi_{i,j-1}}{y_{i}-y_{i-1}}
\right)
\end{eqnarray}
where $2C_{i\pm 1/2,j} = C_{i,j} + C_{i\pm 1,j}$ and
$2C_{i,j\pm 1/2} = C_{i,j} + C_{i,j\pm 1}$.

The algebraic system above can be written as $\matr{A} \vect{u} = \vect{f}$,
where $\matr{A}$ depends on the grid and current $C$ values.
$\vect{f}$ can be chosen to be any function, which is useful for testing the solver.
We initialize $\vect{u}$ to any function, and employ Jacobi iterations
(by writing $\matr{A} = \matr{D} + (\matr{A-D})$, where $\matr{D}$ is diagonal):
\begin{eqnarray}
\vect{f} &=& \matr{A}\vect{u} = \matr{D}\vect{u} + (\matr{A-D})\vect{u} \\
\matr{D}\vect{u} &=& \vect{f} - (\matr{A-D})\vect{u} =
\vect{f} - \matr{A}\vect{u} + \matr{D}\vect{u} \\
\vect{u}_+ &=& \vect{u} + \matr{D}^{-1}(\vect{f} - \matr{A}\vect{u}) =
(\matr{I} - \matr{D}^{-1}\matr{A}) \vect{u} + \matr{D}^{-1}\vect{f} \\
\end{eqnarray}
Therefore, we shall use the following iteration scheme:
\begin{eqnarray}
\vect{u}_+ &=& \matr{T}\vect{u} + \vect{d} \\
\matr{T} &=& \matr{I} - \matr{D}^{-1}\matr{A} \\
\vect{d} &=& \matr{D}^{-1}\vect{f}
\end{eqnarray}
To speed-up the convergence, we shall use Red-Black Gauss-Seidel method,
that updates ``odd'' and ``even'' elements of $\vect{u}$, solving
effectively the linear system for half the variables each time.
\subsection{Boundary conditions}
\subsubsection{Dirichlet}
The condition is given as $U(x, y) = C$.
We take $u_k = U(x_i, y_j) = C$.
Now, it is simply substituted and
linear system's right-hand side is updated accordingly.

\subsubsection{Neumann}
The condition is given as $\bnabla U(x,y) \cdot \vect{\hat n} = C$,
where $\vect{\hat n}$ is normal to domain's boundary.
If we use quadratic approximation, the gradient can be expressed as:
\begin{eqnarray}
  f(x) &=& ax^2 + bx + c \\
  f(x_0 \pm \Delta x) &=&
   a(x_0 \pm \Delta x)^2 + b(x_0 \pm \Delta x) + c \\
  \frac{f(x_0 + \Delta x) - f(x_0 - \Delta x)}{2\Delta x} &=&
   2a x_0 + b = f'(x_0) \\
\end{eqnarray}
Therefore, the boundary value can be approximated by:
\begin{eqnarray}
 U(x + \Delta x,y + \Delta y) &\approx& U(x, y) + \partial_x U(x_c,y_c) \Delta x +
 \partial_x U(x_c,y_c) \Delta y \\
 x_c &=& x + \frac{\Delta x}{2} \\
 y_c &=& y + \frac{\Delta y}{2}
\end{eqnarray}

\subsection{Specific boundary conditions}
\subsubsection{$R = 1$}
\begin{eqnarray}
  \frac{\partial C}{\partial R} &=&
   C \frac{\partial \varPhi}{\partial R} \\
  \varPhi &=& \mathscr{V} - \ln C + \ln \gamma
\end{eqnarray}
Take $\mathscr{V} = -\ln \gamma$ and note that:
\begin{eqnarray}
  \frac{\partial}{\partial R} \ln C &=&
  \frac{1}{C}\frac{\partial C}{\partial R} =
  \frac{\partial \varPhi}{\partial R} \\
  \varPhi &=& -\ln C
\end{eqnarray}
Use ghost-point \#0 to write the following boundary equations:
\begin{eqnarray}
  \varPhi_1 - \varPhi_0 &=& \ln C_1 - \ln C_0 \\
  \varPhi_1 + \varPhi_0 &=& - \ln C_1 - \ln C_0
\end{eqnarray}
Add and subtract to get 2 Dirichlet conditions:
\begin{eqnarray}
  \varPhi_1 &=& - \ln C_0 \\
  \varPhi_0 &=& - \ln C_1 \\
  C_0 &=& e^{-\varPhi_1}
\end{eqnarray}
\subsubsection{$R \rightarrow \infty$}
$C$ gets uniform, and we get Dirichlet:
\begin{eqnarray}
 C = 1
\end{eqnarray}
The field radial component is Neumann:
\begin{eqnarray}
 \frac{\partial \varPhi}{\partial R} = -\mathscr{E} \cos \theta
\end{eqnarray}
\subsubsection{$\Theta = 0/\pi$}
Using symmetry considerations, we have Neumann conditions:
\begin{eqnarray}
 \frac{\partial \varPhi}{\partial \Theta} &=& 0 \\
 \frac{\partial C}{\partial \Theta} &=& 0 \\
\end{eqnarray}

\section{Advection}
\subsection{Differential equation}
\begin{equation}
	\bnabla^2 C - \alpha \mathbf{V} \bcdot \bnabla C = 0	
\end{equation}

\subsection{1D example}
\begin{eqnarray}
  f'' - \alpha f' = 0 \\
  f(0) = 0 \\ f(1) = 1
\end{eqnarray}
Use $f(x) = e^{\gamma x}$ so $\gamma \in \{0, \alpha\}$ so:
\begin{eqnarray}
  f(x) &=& Ae^{\alpha x} + B \\
  0 &=& A + B \\
  1 &=& Ae^{\alpha} + B
\end{eqnarray}
The continuous solution is:
\begin{eqnarray}
  f(x) &=& \frac{e^{\alpha x} - 1}{e^{\alpha} - 1}
\end{eqnarray}

\subsection{Central difference}
We start by using the following scheme:
\begin{eqnarray}
  \frac{f_{k-1}-2f_k+f_{k+1}}{h^2}
  - \alpha \frac{f_{k+1}-f_{k-1}}{2h} &=& 0 \\
(f_{k-1}-2f_k+f_{k+1}) - \eps (f_{k+1}-f_{k-1}) &=& 0 \\
\eps = \frac{\alpha h}{2} \\
(1-\eps)f_{k-1}-2f_k+(1+\eps)f_{k+1} &=& 0
\end{eqnarray}
Write $f_k = \gamma^k$ to get:
\begin{eqnarray}
  (1-\eps)\gamma^{k-1} - 2\gamma^k + (1+\eps)\gamma^{k+1}&=& 0 \\
  (1-\eps)\gamma - 2\gamma + (1+\eps)\gamma^2&=& 0 \\
  \gamma = \frac{1 \pm \sqrt{1 - (1-\eps)(1+\eps)}}{1+\eps}
         = \frac{1 \pm |\eps|}{1+\eps} \in
           \left\{1, \frac{1- \eps}{1+\eps}\right\}
\end{eqnarray}
Take $f_0 = 0$ and $f_N = 1$ such that $h N = 1$, so:
\begin{eqnarray}
  f_k &=& \frac{1 - \left(\frac{1- \eps}{1+\eps}\right)^k}
  {1 - \left(\frac{1- \eps}{1+\eps}\right)^N}
\end{eqnarray}
Denote $x = \frac{k}{N}$ for $|\eps| < 1$:
\begin{eqnarray}
(1+\eps)^k = \left(1+\frac{\alpha h}{2}\right)^k =
\left(1+\frac{\alpha}{2N}\right)^k =
\left(1+\frac{\frac{\alpha k}{2N}}{k}\right)^k \approx
e^{\frac{\alpha k}{2N}} = e^{\frac{\alpha x}{2}}
\end{eqnarray}
So:
\begin{eqnarray}
  \left(\frac{1- \eps}{1+\eps}\right)^k &\approx& e^{\alpha x} \\
  f_k &\approx& \frac{1 - e^{\alpha x}}{1 - e^{\alpha}}
\end{eqnarray}
Otherwise ($h > 2/|\alpha|$), we get an oscillating solution, since $\gamma < 0$.
\subsection{Upwind difference}
We write:
\begin{eqnarray}
\frac{f_{k-1}-2f_k+f_{k+1}}{h^2} - \alpha \frac{f_k - f_{k-1}}{h} &=& 0 \\
(f_{k-1}-2f_k+f_{k+1}) - \alpha h (f_k - f_{k-1}) &=& 0 \\
(1 + 2\eps)f_{k-1}- (2 + 2\eps)f_k + f_{k+1} &=& 0 \\
2\eps = \alpha h
\end{eqnarray}
Again, write $f_k = \gamma^k$ to get:
\begin{eqnarray}
 \gamma^2 - (2 + 2\eps) \gamma + (1 + 2\eps) &=& 0
\end{eqnarray}
\begin{eqnarray}
\gamma &=& 1+\eps \pm \sqrt{(1+\eps)^2 - 1 - 2\eps} = 1 + \eps \pm |\eps| \in \{1, 1+2\eps\}
\end{eqnarray}
Given $\alpha > 0$, we note that there are no oscillations since $\gamma > 0$.

Moreover, the solution for $f_0 = 0$ and $f_N = 1$ (where $h N = 1$) is:
\begin{eqnarray}
f_k &=& \frac{1 - (1+2\eps)^k}{1 - (1+2\eps)^N}
\end{eqnarray}
Since $(1+2\eps)^k = (1+\alpha h)^k = \left(1 + \frac{\alpha}{N}\right)^k \approx e^{\alpha x}$ for $x = k/N$
so we get that $f_k \rightarrow f(x)$, as desired.
\subsection{Second order upwind scheme}
Suppose $f(x) = ax^2 + bx + c$:
\begin{eqnarray}
  f(0) &=& c \\
  f(-h) &=& ah^2 - bh + c \\
  f(-2h) &=& 4ah^2 - 2bh + c
\end{eqnarray}
Note that:
\begin{eqnarray}
  f(0) - f(-h) &=& bh - ah^2 \\
  f(0) - f(-2h) &=& 2bh - 4ah^2
\end{eqnarray}
This way we get 2nd order upwind approximation for the derivative $f'(0) = b$:
\begin{eqnarray}
  2bh &=& 4\left\{f(0) - f(-h)\right\} - \left\{f(0) - f(-2h)\right\} \\
  b &=& \frac{3f(0) - 4f(-h) + f(-2h)}{2h}
\end{eqnarray}

\section{Stokes}
\begin{eqnarray}
 \bnabla P - \mu \Delta \mathbf{V} &=& \mathbf{F} \\
 \bnabla \bcdot \mathbf{V} &=& 0
\end{eqnarray}
The following system is built:
\begin{eqnarray}
 \mat{ccc}{-\mu\Delta & 0 & \partial_x \\ 0 & -\mu\Delta & \partial_y \\ \partial_x & \partial_y & 0}
 \mat{c}{V_x \\ V_y \\ P} &=& \mat{c}{F_x \\ F_y \\ 0}
\end{eqnarray}
Note that $P$ can be determined only up to an additive constant.
\section{Vanka}
\begin{eqnarray}
 r &=& f - Ax \\
 Ax &=& f \\
 P_I A x &=& P_I f \\
 x &=& P_J^T P_J x + (I - P_J^T P_J) x \\
 P_I A P_J^T P_J x + P_I A  (I - P_J^T P_J) x &=& P_I f \\
 P_I A P_J^T P_J x &=& P_I A  P_J^T P_J x + P_I f - P_I A x \\
 P_J x' &=& P_J x + (P_I A P_J^T)^{-1} P_I (f - Ax) \\
 x' &=& x + P_J^T (P_I A P_J^T)^{-1} P_I (f - Ax) \\
 x' &=& x + M (f - Ax) \\
 M &=& \sum_{I,J} P_J^T (P_I A P_J^T)^{-1} P_I
\end{eqnarray}

\section{Stress Tensors}
The stress tensor represented as a symmetric $3 \times 3$ matrix $\mathbb{S}$.
The force $\boldsymbol{F}$ acting on a volume element can be written as $\boldsymbol{F} = \bnabla \cdot \mathbb{S}$.

\subsection{Pressure}
Denote $\mathbb{S} = -P \mathbb{I}$, so $\boldsymbol{F} = -\bnabla P$.

\subsection{Viscosity}
Denote $\mathbb{S} = \bnabla \bV + (\bnabla \bV)^\dagger$.
Thus $\mathbb{S}_{ij} = \partial_i V_j + \partial_j V_i$:
\begin{eqnarray}
F_j &=& \sum_i \partial_i \mathbb{S}_{ij} = \sum_i \partial^2_i V_j + \sum_i \partial_{ij} V_i
= \nabla^2 V_j + \partial_j \left(\sum_i \partial_i V_i\right) \\
\boldsymbol{F} &=& \nabla^2 \bV + \bnabla (\bnabla \cdot \bV)
\end{eqnarray}
Since we assume divergence-free flow ($\bnabla \cdot \bV = 0$):
\begin{eqnarray}
\boldsymbol{F} &=& \nabla^2 \bV
\end{eqnarray}
\subsection{Maxwell}
Denote $\mathbb{S} = \bnabla \varPhi \bnabla \varPhi - \frac{1}{2} (\bnabla \varPhi \cdot \bnabla \varPhi) \mathbb{I}$.
Thus $\mathbb{S}_{ij} = \partial_i \varPhi \partial_j \varPhi - \frac{1}{2} \delta_{ij} \sum_{k} (\partial_k \varPhi)^2$
\begin{eqnarray}
F_j &=& \sum_i \partial_i \mathbb{S}_{ij} =
\sum_i \partial_i (\partial_i \varPhi \partial_j \varPhi) - \frac{1}{2} \partial_j \sum_{k} (\partial_k \varPhi)^2 \\
F_j &=&  \partial_j \varPhi \sum_i \partial^2_i \varPhi +
\sum_i \partial_i \varPhi \partial_{ij} \varPhi - \sum_{k} \partial_k \varPhi \partial_{jk} \varPhi \\
\boldsymbol{F} &=& \bnabla \varPhi \cdot \nabla^2 \varPhi
\end{eqnarray}

\section{Spherical Coordinates}
\begin{eqnarray}
x &=& r \sin \theta \cos \phi \\
y &=& r \sin \theta \sin \phi \\
z &=& r \cos \theta
\end{eqnarray}
Assume symmetry around $z$ axis - no dependence on $\phi$:
\begin{eqnarray}
\bnabla f &=& \frac{\partial f}{\partial r} \mathbf{\hat{r}} +
\frac{1}{r} \frac{\partial f}{\partial \theta} \mathbf{\hat{\theta}} +
\frac{1}{r \sin\theta} \frac{\partial f}{\partial \phi} \mathbf{\hat{\phi}}
\\
\bnabla \mathbf{\cdot} \mathbf{F} &=& \frac{
\Delta_r\left\{r d\theta \cdot r \sin \theta d\phi \cdot F_r\right\} +
\Delta_\theta\left\{dr \cdot r \sin \theta d\phi \cdot F_\theta\right\} +
\Delta_\phi\left\{dr \cdot r d\theta \cdot F_\phi\right\}
}{dr \cdot r d\theta \cdot r \sin \theta d\phi}
\\
&=& \frac{1}{r^2}\frac{\partial}{\partial r} \left( r^2 \cdot F_r\right)
  + \frac{1}{r \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \cdot F_\theta\right)
  + \frac{1}{r \sin\theta} \frac{\partial F_\phi}{\partial \phi}
\end{eqnarray}
Scalar Laplacian derivation:
\begin{eqnarray}
\Laplacian f &=& \bnabla \mathbf{\cdot} \bnabla f = \frac{1}{r^2}\frac{\partial}{\partial r}
\left( r^2 \frac{\partial f}{\partial r} \right) +
\frac{1}{r^2 \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \cdot \frac{\partial f}{\partial \theta}\right)
+ \frac{1}{r^2 \sin^2\theta} \frac{\partial^2 f}{\partial \phi^2}
\\
r^2 \sin\theta \cdot \bnabla^2 f &=& \frac{\partial}{\partial r} \left( r^2 \sin \theta \frac{\partial f}{\partial r} \right) +
\frac{\partial}{\partial \theta} \left( \sin\theta \cdot \frac{\partial f}{\partial \theta}\right) +
\frac{\partial}{\partial \phi} \left( \frac{1}{\sin\theta} \cdot \frac{\partial f}{\partial \phi}\right)
\end{eqnarray}

Unit vectors:
\begin{eqnarray}
 \br &=& \mat{c}{r\sin\theta \cos\phi \\ r\sin\theta \sin\phi \\ r\cos\theta} \\
 \brhat &=& \deriv{\br}{r}
 = \mat{c}{\sin\theta \cos\phi \\ \sin\theta \sin\phi \\ \cos\theta} \\
 \bthetahat &=& \frac{1}{r} \deriv{\br}{\theta}
 = \mat{c}{\cos\theta \cos\phi \\ \cos\theta \sin\phi \\ -\sin\theta} \\
 \bphihat &=& \frac{1}{r \sin \theta} \deriv{\br}{\phi}
 = \mat{c}{-\sin\phi \\ \cos\phi \\ 0}
\end{eqnarray}
Note that:
\begin{eqnarray}
  \deriv{\brhat}{r} = \deriv{\bthetahat}{r} = \deriv{\bphihat}{r} = \mathbf{0} \\
  \deriv{\brhat}{\theta} = \bthetahat \\
  \deriv{\bthetahat}{\theta} = -\brhat \\
  \deriv{\brhat}{\phi} = \sin \theta \cdot \bphihat \\
  \deriv{\bthetahat}{\phi} = \cos \theta \cdot \bphihat \\
  \deriv{\bphihat}{\phi} = -\sin \theta \cdot \brhat -\cos \theta \cdot \bthetahat
\end{eqnarray}
Compute rate of strain tensor:
\begin{eqnarray}
\bnabla\bV &=& \left\{ \brhat \deriv{}{r} +
\bthetahat \frac{1}{r} \deriv{}{\theta} +
\bphihat \frac{1}{r \sin\theta} \deriv{}{\phi} \right\}
\left( V_r \brhat + V_\theta \bthetahat + V_\phi \bphihat \right)
\\
\deriv{\bV}{r} &=&
\deriv{V_r}{r}\brhat + \deriv{V_\theta}{r}\bthetahat + \deriv{V_\phi}{r}\bphihat
\\
\deriv{\bV}{\theta} &=&
\deriv{V_r}{\theta}\brhat + \deriv{V_\theta}{\theta}\bthetahat + \deriv{V_\phi}{\theta}\bphihat
+ V_r\bthetahat - V_\theta\brhat
\\
\deriv{\bV}{\phi} &=&
\deriv{V_r}{\phi}\brhat + \deriv{V_\theta}{\phi}\bthetahat + \deriv{V_\phi}{\phi}\bphihat
+ V_r \sin\theta\bphihat + V_\theta \cos\theta\bphihat -
V_\phi \left(\brhat \sin\theta + \bthetahat \cos\theta \right)
\end{eqnarray}
Compute vector Laplacian components by applying it on unit vectors:
\begin{eqnarray}
\Laplacian \bV &=& \frac{1}{r^2}\deriv{}{r}\left(r^2 \deriv{\bV}{r}\right) +
\frac{1}{r^2\sin\theta}\deriv{}{\theta}\left(\sin\theta\deriv{\bV}{\theta}\right)+
\frac{1}{r^2 \sin^2\theta}\deriv{}{\phi}\left(\deriv{\bV}{\phi}\right)
\end{eqnarray}
$\brhat$ component:
\begin{eqnarray}
\Laplacian (V_r\brhat) &=&
\frac{1}{r^2}\deriv{}{r}\left(r^2 \deriv{V_r}{r}\right)\brhat
\\ &+&
\frac{1}{r^2\sin\theta}\deriv{}{\theta}\left(
\sin\theta\left(\deriv{V_r}{\theta}\brhat + V_r\bthetahat \right)\right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\deriv{}{\phi}\left(
\deriv{V_r}{\phi}\brhat + V_r \sin\theta\bphihat
\right) \\
\Laplacian (V_r\brhat) &=&
\left(
\frac{2}{r}\deriv{V_r}{r}+\deriv{^2V_r}{r^2}\right)\brhat
\\ &+&
\frac{1}{r^2\sin\theta}\left(
\cos\theta\left(\deriv{V_r}{\theta}\brhat + V_r\bthetahat \right) +
\sin\theta\left(\deriv{^2V_r}{\theta^2}\brhat + \deriv{V_r}{\theta}\bthetahat + \deriv{V_r}{\theta}\bthetahat - V_r\brhat\right)
\right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\left(
\deriv{^2V_r}{\phi^2}\brhat + \deriv{V_r}{\phi} \sin\theta\bphihat +
\deriv{V_r}{\phi}\bphihat\sin\theta - V_r \sin\theta
\left(\brhat \sin\theta + \bthetahat \cos\theta \right)
\right)
\\
\Laplacian (V_r\brhat) &=&
\left(
\frac{2}{r}\deriv{V_r}{r}+\deriv{^2V_r}{r^2}-\frac{2V_r}{r^2}
+ \frac{1}{r^2}\deriv{^2V_r}{\theta^2}
+ \frac{\cot\theta}{r^2} \deriv{V_r}{\theta}
+ \frac{1}{r^2 \sin^2\theta} \deriv{^2V_r}{\phi^2}
\right)\brhat
\\ &+& \frac{2}{r^2} \deriv{V_r}{\theta} \bthetahat + \frac{2}{r^2 \sin\theta}\deriv{V_r}{\phi} \bphihat
\end{eqnarray}
$\bthetahat$ component:
\begin{eqnarray}
\Laplacian (V_\theta\bthetahat) &=&
\frac{1}{r^2}\deriv{}{r}\left(r^2 \deriv{V_\theta}{r}\right)\bthetahat
\\ &+&
\frac{1}{r^2\sin\theta}\deriv{}{\theta}\left(
\sin\theta\left(\deriv{V_\theta}{\theta}\bthetahat - V_\theta\brhat \right)\right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\deriv{}{\phi}\left(
\deriv{V_\theta}{\phi}\bthetahat + V_\theta \cos\theta\bphihat
\right)
\\
\Laplacian (V_\theta\bthetahat) &=&
\left(\frac{2}{r}\deriv{V_\theta}{r} + \deriv{^2V_\theta}{r^2}\right)\bthetahat
\\ &+&
\frac{1}{r^2\sin\theta}\left(
\cos\theta\left(\deriv{V_\theta}{\theta}\bthetahat - V_\theta\brhat \right) +
\sin\theta\left(\deriv{^2V_\theta}{\theta^2}\bthetahat - \deriv{V_\theta}{\theta}\brhat
-\deriv{V_\theta}{\theta}\brhat - V_\theta\bthetahat\right)
\right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\left(
\deriv{^2V_\theta}{\phi^2}\bthetahat + \deriv{V_\theta}{\phi} \cos\theta\bphihat +
\deriv{V_\theta}{\phi}\cos\theta\bphihat
- V_\theta \cos\theta \left(\brhat \sin\theta + \bthetahat \cos\theta \right)
\right)
\\
\Laplacian (V_\theta\bthetahat) &=&
\left(-\frac{2\cot\theta}{r^2}V_\theta - 2\deriv{V_\theta}{\theta}\right)\brhat +
\left(\frac{2}{r}\deriv{V_\theta}{r} + \deriv{^2V_\theta}{r^2} +
\frac{\cot\theta}{r^2} \deriv{V_\theta}{\theta} +
\frac{1}{r^2}\deriv{^2V_\theta}{\theta^2}\right)\bthetahat
\\
\\ &+&
\frac{1}{r^2 \sin^2\theta}\left(
\deriv{^2V_\theta}{\phi^2} - V_\theta \right)\bthetahat
+ \frac{2 \cot\theta}{r^2 \sin\theta} \deriv{V_\theta}{\phi} \bphihat
\end{eqnarray}
$\bphihat$ component:
\begin{eqnarray}
\Laplacian (V_\phi\bphihat) &=&
\frac{1}{r^2}\deriv{}{r}\left(r^2 \deriv{V_\phi}{r}\right)\bphihat +
\frac{1}{r^2\sin\theta}\deriv{}{\theta}\left(
\sin\theta \deriv{V_\phi}{\theta}\bphihat \right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\deriv{}{\phi}\left(
\deriv{V_\phi}{\phi}\bphihat
- V_\phi \left(\brhat \sin\theta + \bthetahat \cos\theta\right)
\right)
\\
\Laplacian (V_\phi\bphihat) &=&
\frac{1}{r^2}\deriv{}{r}\left(r^2 \deriv{V_\phi}{r}\right)\bphihat +
\frac{1}{r^2\sin\theta}\deriv{}{\theta}\left(
\sin\theta \deriv{V_\phi}{\theta}\bphihat \right)
\\ &+&
\frac{1}{r^2 \sin^2\theta}\deriv{}{\phi}\left(
\deriv{V_\phi}{\phi}\bphihat
- V_\phi \left(\brhat \sin\theta + \bthetahat \cos\theta\right)
\right)
\\
\Laplacian (V_\phi\bphihat) &=&
\left(\frac{2}{r} \deriv{V_\phi}{r} + \deriv{^2V_\phi}{r^2}\right)\bphihat
+
\frac{1}{r^2\sin\theta}\left(
\cos\theta \deriv{V_\phi}{\theta} +
\sin\theta \deriv{^2V_\phi}{\theta^2}
\right)\bphihat
\\ &+&
\frac{1}{r^2 \sin^2\theta}\left(
\deriv{^2V_\phi}{\phi^2}\bphihat
- 2 \deriv{V_\phi}{\phi} \left(\brhat \sin\theta + \bthetahat \cos\theta\right)
- V_\phi \bphihat
\right)
\end{eqnarray}
In summary:
\begin{eqnarray}
\Laplacian \bV &=& \left(\Laplacian V_r - \frac{2V_r}{r^2}\right)\brhat
+ \frac{2}{r^2}\deriv{V_r}{\theta} \bthetahat + \frac{2}{r^2 \sin\theta}\deriv{V_r}{\phi} \bphihat \\
&-&
\frac{2}{r^2 \sin\theta} \deriv{\left(V_\theta \sin\theta \right)}{\theta}\brhat
+ \left(\Laplacian V_\theta - \frac{V_\theta}{r^2 \sin^2\theta}\right) \bthetahat
+ \frac{2 \cot\theta}{r^2 \sin\theta} \deriv{V_\theta}{\phi} \bphihat \\
&-&
\frac{2}{r^2 \sin\theta}\deriv{V_\phi}{\phi}\brhat -
\frac{2 \cot\theta}{r^2 \sin\theta}\deriv{V_\phi}{\phi}\bthetahat
+ \left(\Laplacian V_\phi - \frac{V_\phi}{r^2 \sin^2\theta}\right)\bphihat
\end{eqnarray}

Since $V_\phi = 0$ and $\deriv{}{\phi}(\cdot) = 0$, we get:
\begin{eqnarray}
\Laplacian \bV &=& \left(\Laplacian V_r - \frac{2V_r}{r^2} - \frac{2}{r^2 \sin\theta} \deriv{\left(V_\theta \sin\theta \right)}{\theta}\right)\brhat
\\
&+&
\left(\Laplacian V_\theta - \frac{V_\theta}{r^2 \sin^2\theta} + \frac{2}{r^2}\deriv{V_r}{\theta}\right) \bthetahat
\\
\Laplacian \bV &=& \left(
\frac{1}{r^2}\deriv{}{r}\left( r^2 \deriv{V_r}{r} \right) + \frac{1}{r^2 \sin\theta} \deriv{}{\theta} \left( \sin\theta \cdot \deriv{V_r}{\theta}\right)
 - \frac{2V_r}{r^2} - \frac{2}{r^2 \sin\theta} \deriv{\left(V_\theta \sin\theta \right)}{\theta}\right)\brhat \\
&+& \left(
\frac{1}{r^2}\deriv{}{r}\left( r^2 \deriv{V_\theta}{r} \right) + \frac{1}{r^2 \sin\theta} \deriv{}{\theta} \left( \sin\theta \cdot \deriv{V_\theta}{\theta}\right)
 - \frac{V_\theta}{r^2 \sin^2\theta} + \frac{2}{r^2}\deriv{V_r}{\theta}\right) \bthetahat
\end{eqnarray}
Together with continuity equation and pressure force:
\begin{eqnarray}
\bnabla \cdot \bV &=& \frac{1}{r^2}\frac{\partial}{\partial r} \left( r^2 \cdot V_r\right)
  + \frac{1}{r \sin\theta} \frac{\partial}{\partial \theta} \left( \sin\theta \cdot V_\theta\right)
\\
\bnabla P &=& \deriv{P}{r} \brhat + \frac{1}{r}\deriv{P}{\theta} \bthetahat
\end{eqnarray}
\section{Stokes flow}
\begin{eqnarray}
\mu \nabla^2 \bV &=& \bnabla P \\
\bnabla \cdot \bV &=& 0
\end{eqnarray}
The solution for no-slip sphere of radius $a$ is:
\begin{eqnarray}
\bV(\bx) &=& \bU -
\frac{3a}{4} \left[ \frac{\bU}{r} + \frac{\bx \bU \cdot \bx}{r^3} \right] -
\frac{a^3}{4} \left[ \frac{\bU}{r^3} - 3\frac{\bx \bU \cdot \bx}{r^5} \right] \\
P(\bx) &=& -\frac{3\mu a \bU \cdot \bx}{2r^3}
\end{eqnarray}
Rewrite in spherical coordinates:
\begin{eqnarray}
\bV(\bx) &=& U \left(
\cos\theta \left[1 - \frac{3a}{2r} + \frac{a^3}{2r^3}\right] \brhat -
\sin\theta \left[1 - \frac{3a}{4r} - \frac{a^3}{4r^3}\right] \bthetahat
\right) \\
P(\bx) &=& P_0 -\mu U \frac{3a \cos\theta}{2r^2}
\end{eqnarray}
Note that the stress tensor is:
$\mathbb{S} = -P \mathbb{I} + \bnabla \bV + (\bnabla \bV)^\dagger$.
The drag force is found by integrating:
\begin{eqnarray}
\boldsymbol{F} = \iint{\left[\mathbb{S}(a,\theta, \phi) \cdot \brhat\right] a^2 \sin\theta d\phi d\theta} =
\int{\left[\mathbb{S}(a,\theta) \cdot \brhat\right] 2 \pi a^2 \sin\theta d\theta}
\end{eqnarray}
Since we have axisymmetric problem, we expect that
$\boldsymbol{F} = F \boldsymbol{\hat{z}} = F \left(\brhat \cos\theta - \bthetahat \sin\theta\right)$.
\begin{eqnarray}
\mathbb{S} \cdot \brhat &=& -P \brhat + \mu \left(
2\deriv{V_r}{r}\brhat\brhat + \deriv{V_\theta}{r}\bthetahat\brhat +
\frac{1}{r}\left[\deriv{V_r}{\theta} - V_\theta \right]\bthetahat\brhat
\right) \cdot \brhat \\
&=& \left(-P + 2\mu \deriv{V_r}{r}\right)\brhat
+ \mu \left(\deriv{V_\theta}{r} + \frac{1}{r}\left[\deriv{V_r}{\theta} -
V_\theta \right]\right)\bthetahat \\
0 &=& \left.\deriv{V_r}{r}\right|_{r=a} =
\left.\deriv{V_r}{\theta}\right|_{r=a} =
\left.V_\theta\right|_{r=a} \\
\mathbb{S} \cdot \brhat &=&
-P\brhat + \mu \deriv{V_\theta}{r}\bthetahat \\
f_r = (\mathbb{S} \cdot \brhat)_r &=& \frac{3 \mu U}{2a} \cos\theta - P_0 \\
f_\theta = (\mathbb{S} \cdot \brhat)_\theta &=& -\frac{3\mu U}{2a} \sin\theta \\
\boldsymbol{f} = \mathbb{S} \cdot \brhat &=& -P_0 \brhat + \frac{3\mu U}{2a} \boldsymbol{\hat{z}} \\
F &=&
\int_0^\pi \boldsymbol{f} \cdot \boldsymbol{\hat{z}} \cdot 2\pi a^2 \sin\theta \cdot d\theta =
\int_0^\pi \left[f_r \cos\theta - f_\theta \sin\theta\right] \cdot 2\pi a^2 \sin\theta \cdot d\theta
\end{eqnarray}
By integrating on the whole sphere of area $4\pi a^2$, we get Stokes' law:
$\boldsymbol{F} = 6\pi \mu U a \boldsymbol{\hat{z}}$.

\section{Maxwell stress tensor}
\begin{eqnarray}
\bnabla \varPhi &=& \deriv{\varPhi}{r} \brhat
+ \frac{1}{r} \deriv{\varPhi}{\theta} \bthetahat
\\
\mathbb{S} \cdot \brhat &=& \bnabla \varPhi (\bnabla \varPhi \cdot \brhat) -
\frac{1}{2} (\bnabla \varPhi \cdot \bnabla \varPhi) \brhat
\\
\mathbb{S} \cdot \brhat &=& \left(\deriv{\varPhi}{r} \brhat + \frac{1}{r} \deriv{\varPhi}{\theta}\bthetahat \right) \deriv{\varPhi}{r} -
\frac{1}{2} \left(\left(\deriv{\varPhi}{r}\right)^2 +
\left(\frac{1}{r} \deriv{\varPhi}{\theta} \right)^2 \right) \brhat
\\
\mathbb{S} \cdot \brhat &=&
\frac{1}{2} \left(\left(\deriv{\varPhi}{r}\right)^2 -
\left(\frac{1}{r} \deriv{\varPhi}{\theta} \right)^2\right) \brhat +
\frac{1}{r}\deriv{\varPhi}{r}\deriv{\varPhi}{\theta} \bthetahat
\end{eqnarray}

\section{Logarithmic grid}
Consider spherical Laplace equation for $\phi(r)$:
\begin{eqnarray}
 \brc{l}{\Laplacian \phi = \deriv{}{r}\left( r^2 \deriv{\phi}{r} \right) = 0 \\ \phi(1)=1 \\ \phi(1+R)=0} \\
 \phi(r) = \left(\frac{1+R}{R}\right)\frac{1}{r} -\frac{1}{R}
\end{eqnarray}
Using the following grid points $\{r, r\delta, r\delta^2\}$, the discrete equation is:
\begin{eqnarray}
\left\{
\frac{f(r\delta^2) - f(r\delta)}{r\delta^2 - r\delta}
\left(\frac{r\delta^2 + r\delta}{2}\right)^2
-
\frac{f(r\delta) - f(r)}{r\delta - r}
\left(\frac{r\delta + r}{2}\right)^2
\right\}
\left(\frac{2}{r\delta^2 - r}\right) = 0
\end{eqnarray}
Note that $f(r) = 1/r$ is a solution too, since:
\begin{eqnarray}
\left\{
\frac{1 - \delta}{\delta (\delta^2 - \delta)}
\left(\frac{\delta^2 + \delta}{2}\right)^2
-
\frac{1 - \delta}{(\delta - 1)}
\left(\frac{\delta + 1}{2}\right)^2
\right\} \equiv 0
\end{eqnarray}
Thus solving the discrete equation will give the same exact values as the continuous one.

\section{Vorticity}
If the flow is divergence free $\bnabla \cdot \bV = 0$,
we can write it as: $\bV = \bnabla \times \bpsi$.
Since the problem is axisymmetric
$\bV = V_r(r,\theta)\brhat + V_\theta(r,\theta)\bthetahat$,
we must have $\bpsi = \psi(r,\theta) \bphihat$.

Denote the vorticity $\bomega = \bnabla \times \bV =
\omega(r, \theta) \bphihat$,
and using
\begin{eqnarray}
  \bnabla \times (\bnabla \times \bA) &=&
  \bnabla (\bnabla \cdot \bA) - \bnabla^2 \bA
\end{eqnarray}
and $\bnabla \cdot \bpsi = 0$ leads to
\begin{eqnarray}
  \bomega = \bnabla \times \bV = \bnabla \times (\bnabla \times \bpsi) &=& - \bLaplacian \bA = - \bLaplacian \bpsi \\
  \omega &=& \frac{\psi}{r^2 \sin^2\theta} - \Laplacian \psi \\
  \omega &=& \frac{\psi}{r^2 \sin^2\theta} - \frac{1}{r^2}\deriv{}{r} \left( r^2 \deriv{\psi}{r} \right) - \frac{1}{r^2 \sin\theta} \deriv{}{\theta}\left( \sin\theta \cdot \deriv{\psi}{\theta}\right) \\
  \omega &=& \frac{1}{r}\left\{\deriv{(r V_\theta)}{r} - \deriv{V_r}{\theta}\right\}
\end{eqnarray}
After $\psi$ is found, $\bV$ can be computed:
\begin{eqnarray}
  V_r &=& \frac{1}{r \sin\theta}\deriv{(\psi \sin\theta)}{\theta} \\
  V_\theta &=& -\frac{1}{r}\deriv{(r \psi)}{r}
\end{eqnarray}
The vorticity and the stream function for Stokes flow:
\begin{eqnarray}
\bV(\bx) &=& U \left(
\cos\theta \left[1 - \frac{3a}{2r} + \frac{a^3}{2r^3}\right] \brhat -
\sin\theta \left[1 - \frac{3a}{4r} - \frac{a^3}{4r^3}\right] \bthetahat
\right) \\
\omega &=& \frac{3 U a}{2} \frac{\sin\theta}{r^2} \\
\psi &=& \frac{U \sin\theta}{2} \left( r - \frac{3a}{2} + \frac{a^3}{2r^2} \right)
\end{eqnarray}
By definition of stream line,
$\psi(r, 0) = \psi(a, \theta) = \psi(r, \pi) = 0$
for $r \ge 1$ and $\theta \in [0, \pi]$.
%%%%%%%%%%%%%%%%%%%%%%%

\section{Slip velocity}
Denote stream function $\Psi$ as:
\begin{eqnarray}
  V_r &=& \frac{1}{r^2 \sin\theta}\deriv{\Psi}{\theta} \\
  V_\theta &=& -\frac{1}{r \sin\theta}\deriv{\Psi}{r}
\end{eqnarray}
We use the same solution form for $\Psi$ as before:
\begin{eqnarray}
  \Psi &=& (A r^2 + B r + C r^{-1})\sin^2\theta\\
  V_r(\infty, \theta) = 2A \cos\theta &=& 0 \\
  V_\theta(\infty, \theta) = -2A \sin\theta &=& 0 \\
  V_r(1, \theta) = (A+B+C)\cdot 2\cos\theta &=& 0 \\
  V_\theta(1, \theta) = -(2A+B-C)\cdot \sin\theta &=& -W\sin\theta 
\end{eqnarray}
Thus:
\begin{eqnarray}
  \brc{ccc}{A &=& 0 \\ B &=& W/2 \\ C &=& -W/2}
\end{eqnarray}
So the stream function for slipping velocity $V_\theta = -W\sin\theta$
is $\Psi = \frac{W}{2}(r - r^{-1})\sin^2\theta$.

Substituting into Stokes equation we get that:
\begin{eqnarray}
  \bnabla P = \bLaplacian \bV &=& -\frac{2 W \cos\theta}{r^3} \brhat 
  -\frac{W \sin \theta}{r^3} \bthetahat \\
  P &=& P_\infty + \frac{W \cos\theta}{r^2}
\end{eqnarray}

The force acting on the sphere area element in $\bxhat$ direction is:
\begin{eqnarray}
  F &=& \frac{3W \cos(2\theta)}{2}
\end{eqnarray}
Integrated over the whole sphere, the total force is:
\begin{eqnarray}
  F_T &=& -4\pi W
\end{eqnarray}
Thus, in steady state, we have $W = \frac{3}{2}V$, 
in order to balance Stokes drag.
\section{Solution for small $\beta$}
\begin{eqnarray}
  \varPhi &=& \beta \brcs{\frac{1}{4r^2} - r} \cos\theta \\
  C &=&  1 + \beta\frac{3}{4r^2} \cos\theta \\
  \Psi &=& \frac{\cl{U} \sin^2\theta}{2} \brcs{r^2 - \frac{a^3}{r}} \\
  V_r &=& \cl{U} \brcs{1 - \frac{a^3}{r^3}} \cos\theta \\
  V_\theta &=& -\cl{U} \brcs{1 + \frac{a^3}{2r^3}} \sin\theta \\
  P &=& P_\infty 
\end{eqnarray}
Note that though the total force is zero, 
the force acting on each sphere area element is given by:
\begin{eqnarray}
  \bF &=& \frac{3\mu\cl{U}}{a} 
  \brcs{ 2\cos\theta \cdot \brhat + \sin\theta \cdot \bthetahat} \\
  \bF \cdot \bxhat &=& \frac{3\mu\cl{U}}{a} \brcs{ 3\cos^2\theta - 1}
\end{eqnarray}
For small $\beta$, we get using Dukhin-–Derjaguin for slip velocity:
\begin{eqnarray}
V_\theta & \approx & -\beta \cdot 3
\log\brcs{\frac{\gamma^{1/4} + \gamma^{-1/4}}{2\gamma^{1/4}}} \sin\theta \\
\cl{U}_\infty &\approx& \beta \cdot 2 
\log\brcs{\frac{\gamma^{1/4} + \gamma^{-1/4}}{2\gamma^{1/4}}} \\
\cl{U}_\infty &\approx& \beta \cdot 2
\log\brcs{\frac{1 + \gamma^{-1/2}}{2}}
\end{eqnarray}
\end{document}


Batchelor p.222
